<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Structure Review Quiz</title>
    <!-- SCORM API Wrapper -->
    <script src="../scorm-api-wrapper.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .progress-container {
            max-width: 600px;
            margin: 0 auto 30px auto;
            text-align: center;
        }

        .progress-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 35px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 20%, #ffc107 40%, #8bc34a 60%, #4caf50 100%);
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1em;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .progress-fill.low {
            background: linear-gradient(90deg, #f44336 0%, #ff5722 100%);
        }

        .progress-fill.medium {
            background: linear-gradient(90deg, #ff9800 0%, #ffc107 100%);
        }

        .progress-fill.good {
            background: linear-gradient(90deg, #8bc34a 0%, #4caf50 100%);
        }

        .progress-fill.excellent {
            background: linear-gradient(90deg, #4caf50 0%, #2e7d32 100%);
        }

        .progress-fill:not(:empty) {
            min-width: 45px;
        }

        .accuracy-fill {
            background: linear-gradient(90deg, #2196F3 0%, #1976D2 100%);
        }

        .accuracy-fill.low {
            background: linear-gradient(90deg, #f44336 0%, #d32f2f 100%);
        }

        .accuracy-fill.medium {
            background: linear-gradient(90deg, #ff9800 0%, #f57c00 100%);
        }

        .accuracy-fill.good {
            background: linear-gradient(90deg, #4caf50 0%, #388e3c 100%);
        }

        .accuracy-fill.excellent {
            background: linear-gradient(90deg, #2196F3 0%, #1565C0 100%);
        }

        .accuracy-fill:not(:empty) {
            min-width: 45px;
        }

        .dashboard-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
        }

        .dashboard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .tracker-container {
            max-width: 600px;
            margin: 0 auto 15px auto;
            text-align: center;
        }

        .tracker-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .tracker-bar {
            width: 100%;
            height: 35px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .tracker-fill {
            height: 100%;
            width: 0%;
            min-width: 0;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 20%, #ffc107 40%, #8bc34a 60%, #4caf50 100%);
            transition: width 0.6s ease, background 0.3s ease, min-width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .tracker-fill:not(:empty) {
            min-width: 45px;
        }

        .tracker-fill.low {
            background: linear-gradient(90deg, #f44336 0%, #ff5722 100%);
        }

        .tracker-fill.medium {
            background: linear-gradient(90deg, #ff9800 0%, #ffc107 100%);
        }

        .tracker-fill.good {
            background: linear-gradient(90deg, #8bc34a 0%, #4caf50 100%);
        }

        .tracker-fill.excellent {
            background: linear-gradient(90deg, #4caf50 0%, #2e7d32 100%);
        }

        .tracker-stats {
            margin-top: 8px;
            font-size: 0.85em;
            color: #666;
        }

        .progress-stats {
            margin-top: 8px;
            font-size: 0.85em;
            color: #666;
        }

        .instructions {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .question-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #667eea;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(.disabled) {
            background: #f0f7ff;
            transform: translateX(5px);
        }

        .option-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
            font-weight: bold;
        }

        .option-btn.incorrect {
            background: #ffcdd2;
            color: #c62828;
            border-color: #f44336;
            opacity: 0.6;
        }

        .option-btn.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
            line-height: 1.8;
        }

        .feedback.correct {
            background: #c8e6c9;
            color: #1b5e20;
            display: block;
            border-left: 5px solid #4caf50;
        }

        .feedback.incorrect {
            background: #ffcdd2;
            color: #b71c1c;
            display: block;
            border-left: 5px solid #f44336;
        }

        .feedback strong {
            display: inline;
            margin-right: 5px;
            font-size: 1.1em;
        }

        .highlight {
            background: #fff9c4;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .results-container {
            display: none;
            text-align: center;
            padding: 40px;
            background: #f0f7ff;
            border-radius: 15px;
            margin-top: 30px;
        }

        .results-container.show {
            display: block;
        }

        .final-score {
            font-size: 3em;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-message {
            font-size: 1.3em;
            color: #333;
            margin: 20px 0;
        }

        .retry-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .exit-btn {
            background: #9e9e9e;
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 8px;
            cursor: not-allowed;
            font-size: 1.3em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 40px auto;
            display: block;
            opacity: 0.5;
        }

        .exit-btn.active {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            cursor: pointer;
            opacity: 1;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .exit-btn.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(76, 175, 80, 0.4);
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
            }
            50% { 
                box-shadow: 0 4px 20px rgba(76, 175, 80, 0.6);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .progress-fill.updating {
            animation: pulse 0.3s ease;
        }

        .emoji {
            font-size: 2em;
            display: block;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }

            .question-number {
                font-size: 1.1em;
            }

            .question-text {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="dashboard-btn" onclick="saveAndExit(event)">‚Üê Dashboard</a>
        
        <h1>üìù Sentence Structure Review Quiz</h1>
        <p class="subtitle">Test Your Understanding of Simple, Compound, and Complex Sentences</p>

        <!-- Progress Tracker -->
        <div class="tracker-container">
            <div class="tracker-label">Overall Progress</div>
            <div class="tracker-bar">
                <div class="tracker-fill" id="trackerFill">0%</div>
            </div>
            <div class="tracker-stats">
                <span id="trackerStats">0 correct out of 0 attempted | 0% complete</span>
            </div>
        </div>
        
        <!-- Accuracy Tracker -->
        <div class="tracker-container">
            <div class="tracker-label">Accuracy</div>
            <div class="tracker-bar">
                <div class="tracker-fill accuracy-fill" id="accuracyFill">0%</div>
            </div>
            <div class="tracker-stats">
                <span id="accuracyStats">0 correct out of 10 questions | 0% accuracy</span>
            </div>
        </div>

        <div class="instructions">
            <h3>üìö Instructions</h3>
            <p style="margin-top: 10px; font-size: 1.1em;">
                <strong>You must complete ALL the questions to progress.</strong> Try your best on the first attempt - you can only answer each question once!
            </p>
        </div>

        <div id="quizContainer">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <button class="exit-btn" id="exitBtn" disabled>Exit Quiz</button>

        <div class="results-container" id="resultsContainer">
            <h2>üéâ Quiz Complete!</h2>
            <div class="final-score" id="finalScore"></div>
            <div class="score-message" id="scoreMessage"></div>
            <div class="emoji" id="scoreEmoji"></div>
            <button class="retry-btn" onclick="location.reload()">Try Again</button>
        </div>
    </div>

    <script>
        const questions = [
            {
                id: 1,
                concept: "Independent Clause Definition",
                question: "What is an independent clause?",
                options: [
                    "A group of words that needs another clause to make sense",
                    "A group of words with a subject and verb that expresses a complete thought",
                    "A group of words that starts with a conjunction",
                    "A phrase without a subject or verb"
                ],
                correct: 1,
                explanation: "An independent clause has both a subject and a verb AND expresses a complete thought. It can stand alone as a sentence. For example: <span class='highlight'>'She studies hard'</span> is an independent clause."
            },
            {
                id: 2,
                concept: "Simple Sentence Structure",
                question: "Which sentence is a simple sentence?",
                options: [
                    "Although it was raining, we went outside.",
                    "The cat slept on the couch all afternoon.",
                    "I wanted to go swimming, but the pool was closed.",
                    "When the bell rang, the students left quickly."
                ],
                correct: 1,
                explanation: "A simple sentence contains only ONE independent clause (one subject-verb combination that expresses a complete thought). <span class='highlight'>'The cat slept on the couch all afternoon'</span> has one subject (cat) and one main verb (slept). The other options are compound or complex sentences."
            },
            {
                id: 3,
                concept: "Conjunction Definition",
                question: "What is a conjunction?",
                options: [
                    "A word that describes a noun",
                    "A word that shows action",
                    "A word that connects words, phrases, or clauses",
                    "A word that modifies a verb"
                ],
                correct: 2,
                explanation: "A conjunction is <span class='highlight'>a word that connects words, phrases, or clauses</span>. Examples include coordinating conjunctions (FANBOYS: for, and, nor, but, or, yet, so) and subordinating conjunctions (although, because, when, if, since). They act like bridges, joining parts of sentences together to show relationships between ideas."
            },
            {
                id: 4,
                concept: "Compound Sentence Identification",
                question: "Which sentence is a compound sentence?",
                options: [
                    "Because I was tired, I went to bed early.",
                    "The students who studied hard passed the exam.",
                    "I love pizza, but my sister prefers pasta.",
                    "Running quickly, she caught the bus."
                ],
                correct: 2,
                explanation: "A compound sentence joins TWO independent clauses with a coordinating conjunction (FANBOYS). <span class='highlight'>'I love pizza, but my sister prefers pasta'</span> has two complete thoughts joined by 'but'. Notice the comma before the conjunction! The first option is a complex sentence, not compound."
            },
            {
                id: 5,
                concept: "Compound Sentence Punctuation",
                question: "Which sentence has correct punctuation for a compound sentence?",
                options: [
                    "The movie was long but it was interesting.",
                    "The movie was long, but it was interesting.",
                    "The movie was long but, it was interesting.",
                    "The movie, was long but it was interesting."
                ],
                correct: 1,
                explanation: "When joining two independent clauses with a FANBOYS conjunction, place a comma BEFORE the conjunction. <span class='highlight'>'The movie was long, but it was interesting'</span> follows this rule correctly. The comma goes right before 'but', not after it!"
            },
            {
                id: 6,
                concept: "Dependent Clause Definition",
                question: "What is a dependent clause?",
                options: [
                    "A complete sentence that can stand alone",
                    "A group of words with a subject and verb that CANNOT stand alone",
                    "A phrase without a subject",
                    "Two independent clauses joined together"
                ],
                correct: 1,
                explanation: "A dependent clause has a subject and verb but does NOT express a complete thought‚Äîit depends on an independent clause to make sense. Example: <span class='highlight'>'Although she was tired'</span> is a dependent clause. It leaves you wondering: 'What happened even though she was tired?' It needs more information!"
            },
            {
                id: 7,
                concept: "Subordinating Conjunctions",
                question: "Which words are subordinating conjunctions?",
                options: [
                    "and, but, or, so",
                    "although, because, when, if, since",
                    "the, a, an, this",
                    "very, quite, extremely, really"
                ],
                correct: 1,
                explanation: "Subordinating conjunctions like <span class='highlight'>although, because, when, if, since, while, after, before, unless, until</span> are used to create complex sentences. They introduce dependent clauses and show relationships like time, cause, contrast, or condition between clauses."
            },
            {
                id: 8,
                concept: "Complex Sentence Identification",
                question: "Which sentence is a complex sentence?",
                options: [
                    "I studied hard, and I passed the test.",
                    "The teacher explained the lesson clearly.",
                    "Although it was raining, we went to the park.",
                    "She likes chocolate ice cream and vanilla cake."
                ],
                correct: 2,
                explanation: "A complex sentence has ONE independent clause and ONE dependent clause joined by a subordinating conjunction. <span class='highlight'>'Although it was raining, we went to the park'</span> has a dependent clause ('Although it was raining') and an independent clause ('we went to the park'). The first option is compound, not complex."
            },
            {
                id: 9,
                concept: "Complex Sentence Punctuation - Dependent First",
                question: "Which sentence shows correct punctuation when the dependent clause comes FIRST?",
                options: [
                    "Because I was late the teacher was angry.",
                    "Because, I was late the teacher was angry.",
                    "Because I was late, the teacher was angry.",
                    "Because I was late; the teacher was angry."
                ],
                correct: 2,
                explanation: "When a dependent clause starts the sentence, place a comma AFTER it, before the independent clause. <span class='highlight'>'Because I was late, the teacher was angry'</span> is correct. Think of it this way: dependent clause first = comma needed. The comma helps readers pause before the main idea."
            },
            {
                id: 10,
                concept: "Complex Sentence Punctuation - Independent First",
                question: "Which sentence shows correct punctuation when the independent clause comes FIRST?",
                options: [
                    "I stayed inside, because it was raining.",
                    "I stayed inside because it was raining.",
                    "I stayed, inside because it was raining.",
                    "I stayed inside because, it was raining."
                ],
                correct: 1,
                explanation: "When the independent clause comes first and the dependent clause comes last, you generally do NOT use a comma. <span class='highlight'>'I stayed inside because it was raining'</span> is correct. Remember: independent first = no comma needed (in most cases). Exceptions include 'whereas' and non-defining relative clauses."
            }
        ];

        let currentQuestion = 0;
        let correctAnswers = 0;
        let answeredQuestions = 0;
        const totalQuestions = 10;
        let answeredSet = new Set();  // Track answered questions
        let correctSet = new Set();   // Track correct answers

        function renderQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.id = `question-${q.id}`;

                questionDiv.innerHTML = `
                    <div class="question-number">Question ${index + 1}: ${q.concept}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options" id="options-${q.id}">
                        ${q.options.map((option, i) => `
                            <button class="option-btn" onclick="checkAnswer(${q.id}, ${i})">${option}</button>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback-${q.id}"></div>
                `;

                container.appendChild(questionDiv);
            });
        }

        function checkAnswer(questionId, selectedIndex) {
            const question = questions.find(q => q.id === questionId);
            const optionsDiv = document.getElementById(`options-${questionId}`);
            const buttons = optionsDiv.querySelectorAll('.option-btn');
            const feedback = document.getElementById(`feedback-${questionId}`);
            const selectedButton = buttons[selectedIndex];

            // Prevent multiple answers
            if (selectedButton.classList.contains('disabled')) {
                return;
            }

            // Disable all buttons for this question
            buttons.forEach(btn => {
                btn.classList.add('disabled');
                btn.style.cursor = 'not-allowed';
            });

            answeredQuestions++;

            // Track this question as answered
            if (!answeredSet.has(questionId)) {
                answeredSet.add(questionId);
            }

            if (selectedIndex === question.correct) {
                // Correct answer
                selectedButton.classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = `<strong>‚úì Correct!</strong> ${question.explanation}`;
                correctAnswers++;
                correctSet.add(questionId);
            } else {
                // Incorrect answer
                selectedButton.classList.add('incorrect');
                buttons[question.correct].classList.add('correct');
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `<strong>‚úó Not quite.</strong> ${question.explanation}`;
            }

            updateProgressTracker();

            // Show results when all questions are answered
            if (answeredQuestions === questions.length) {
                setTimeout(showResults, 1000);
            }
        }

        function updateProgressTracker() {
            const progressPercentage = Math.round((answeredSet.size / totalQuestions) * 100);
            const accuracyPercentage = Math.round((correctSet.size / totalQuestions) * 100);
            
            // Update progress bar
            const trackerFill = document.getElementById('trackerFill');
            const trackerStats = document.getElementById('trackerStats');
            
            trackerFill.style.width = progressPercentage + '%';
            trackerFill.textContent = progressPercentage + '%';
            
            trackerFill.classList.remove('low', 'medium', 'good', 'excellent');
            if (progressPercentage >= 90) {
                trackerFill.classList.add('excellent');
            } else if (progressPercentage >= 70) {
                trackerFill.classList.add('good');
            } else if (progressPercentage >= 50) {
                trackerFill.classList.add('medium');
            } else if (progressPercentage > 0) {
                trackerFill.classList.add('low');
            }
            
            trackerStats.textContent = `${correctSet.size} correct out of ${answeredSet.size} attempted | ${progressPercentage}% complete`;
            
            // Update accuracy bar
            const accuracyFill = document.getElementById('accuracyFill');
            const accuracyStats = document.getElementById('accuracyStats');
            
            accuracyFill.style.width = accuracyPercentage + '%';
            accuracyFill.textContent = accuracyPercentage + '%';
            
            accuracyFill.classList.remove('low', 'medium', 'good', 'excellent');
            if (accuracyPercentage >= 90) {
                accuracyFill.classList.add('excellent');
            } else if (accuracyPercentage >= 70) {
                accuracyFill.classList.add('good');
            } else if (accuracyPercentage >= 50) {
                accuracyFill.classList.add('medium');
            } else if (accuracyPercentage > 0) {
                accuracyFill.classList.add('low');
            }
            
            accuracyStats.textContent = `${correctSet.size} correct out of ${totalQuestions} questions | ${accuracyPercentage}% accuracy`;
            
            // Save to SCORM
            ScormAPI.saveLessonProgress('sentence_structure_quiz', {
                percentage: progressPercentage,
                accuracy: accuracyPercentage,
                correct: correctSet.size,
                attempted: answeredSet.size,
                total: totalQuestions,
                timestamp: new Date().toISOString()
            });
            ScormAPI.updateCourseProgress();
        }

        function showResults() {
            const resultsContainer = document.getElementById('resultsContainer');
            const finalScore = document.getElementById('finalScore');
            const scoreMessage = document.getElementById('scoreMessage');
            const scoreEmoji = document.getElementById('scoreEmoji');
            const exitBtn = document.getElementById('exitBtn');

            resultsContainer.classList.add('show');
            resultsContainer.scrollIntoView({ behavior: 'smooth' });

            const percentage = (correctAnswers / questions.length) * 100;
            finalScore.textContent = `${correctAnswers}/10 (${Math.round(percentage)}%)`;

            if (percentage === 100) {
                scoreMessage.textContent = "Perfect Score! You've mastered sentence structure!";
                scoreEmoji.textContent = "üèÜüéâ";
            } else if (percentage >= 90) {
                scoreMessage.textContent = "Excellent work! You have a strong understanding of sentence structure!";
                scoreEmoji.textContent = "‚≠êüòä";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You understand most concepts well!";
                scoreEmoji.textContent = "üëçüòä";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good effort! Review the explanations to strengthen your understanding.";
                scoreEmoji.textContent = "üìöüí™";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "You're making progress! Review the concepts and try again.";
                scoreEmoji.textContent = "üìñ";
            } else {
                scoreMessage.textContent = "Keep practicing! Review the lesson materials and try the quiz again.";
                scoreEmoji.textContent = "üí™üìù";
            }

            // Activate exit button
            exitBtn.disabled = false;
            exitBtn.classList.add('active');
            exitBtn.style.cursor = 'pointer';
        }

        // Save and exit function
        function saveAndExit(event) {
            event.preventDefault();
            ScormAPI.commit();
            window.location.href = '../index.html';
        }

        // Initialize quiz on page load
        document.addEventListener('DOMContentLoaded', function() {
            ScormAPI.initialize();
            renderQuiz();
        });
    </script>
</body>
</html>