<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subject-Verb Agreement Review Quiz</title>
    <!-- SCORM API Wrapper -->
    <script src="../scorm-api-wrapper.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .instructions {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .question-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #667eea;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(.disabled) {
            background: #f0f7ff;
            transform: translateX(5px);
        }

        .option-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
            font-weight: bold;
        }

        .option-btn.incorrect {
            background: #ffcdd2;
            color: #c62828;
            border-color: #f44336;
            opacity: 0.6;
        }

        .option-btn.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
            line-height: 1.8;
        }

        .feedback.correct {
            background: #c8e6c9;
            color: #1b5e20;
            display: block;
            border-left: 5px solid #4caf50;
        }

        .feedback.incorrect {
            background: #ffcdd2;
            color: #b71c1c;
            display: block;
            border-left: 5px solid #f44336;
        }

        .feedback strong {
            display: inline;
            margin-right: 5px;
            font-size: 1.1em;
        }

        .highlight {
            background: #fff9c4;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .results-container {
            display: none;
            text-align: center;
            padding: 40px;
            background: #f0f7ff;
            border-radius: 15px;
            margin-top: 30px;
        }

        .results-container.show {
            display: block;
        }

        .final-score {
            font-size: 3em;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-message {
            font-size: 1.3em;
            color: #333;
            margin: 20px 0;
        }

        .retry-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .exit-btn {
            background: #9e9e9e;
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 8px;
            cursor: not-allowed;
            font-size: 1.3em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 40px auto;
            display: block;
            opacity: 0.5;
        }

        .exit-btn.active {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            cursor: pointer;
            opacity: 1;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .exit-btn.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(76, 175, 80, 0.4);
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
            }
            50% {
                box-shadow: 0 4px 20px rgba(76, 175, 80, 0.6);
            }
        }

        .emoji {
            font-size: 2em;
            display: block;
            margin: 20px 0;
        }

        .dashboard-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
        }

        .dashboard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .tracker-container {
            max-width: 600px;
            margin: 0 auto 15px auto;
            text-align: center;
        }

        .tracker-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .tracker-bar {
            width: 100%;
            height: 35px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .tracker-fill {
            height: 100%;
            width: 0%;
            min-width: 0;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 20%, #ffc107 40%, #8bc34a 60%, #4caf50 100%);
            transition: width 0.6s ease, background 0.3s ease, min-width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .tracker-fill:not(:empty) {
            min-width: 45px;
        }

        .tracker-fill.low {
            background: linear-gradient(90deg, #f44336 0%, #ff5722 100%);
        }

        .tracker-fill.medium {
            background: linear-gradient(90deg, #ff9800 0%, #ffc107 100%);
        }

        .tracker-fill.good {
            background: linear-gradient(90deg, #8bc34a 0%, #4caf50 100%);
        }

        .tracker-fill.excellent {
            background: linear-gradient(90deg, #4caf50 0%, #2e7d32 100%);
        }

        .accuracy-fill {
            background: linear-gradient(90deg, #2196F3 0%, #1976D2 100%);
        }

        .accuracy-fill.low {
            background: linear-gradient(90deg, #f44336 0%, #d32f2f 100%);
        }

        .accuracy-fill.medium {
            background: linear-gradient(90deg, #ff9800 0%, #f57c00 100%);
        }

        .accuracy-fill.good {
            background: linear-gradient(90deg, #4caf50 0%, #388e3c 100%);
        }

        .accuracy-fill.excellent {
            background: linear-gradient(90deg, #2196F3 0%, #1565C0 100%);
        }

        .accuracy-fill:not(:empty) {
            min-width: 45px;
        }

        .tracker-stats {
            margin-top: 8px;
            font-size: 0.85em;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .question-number {
                font-size: 1.1em;
            }

            .question-text {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="dashboard-btn" onclick="saveAndExit(event)">‚Üê Dashboard</a>

        <h1>‚úÖ Subject-Verb Agreement Review Quiz</h1>
        <p class="subtitle">Test Your Understanding of Subject-Verb Agreement Rules</p>

        <!-- Progress Tracker -->
        <div class="tracker-container">
            <div class="tracker-label">Overall Progress</div>
            <div class="tracker-bar">
                <div class="tracker-fill" id="trackerFill">0%</div>
            </div>
            <div class="tracker-stats">
                <span id="trackerStats">0 correct out of 0 attempted | 0% complete</span>
            </div>
        </div>

        <!-- Accuracy Tracker -->
        <div class="tracker-container">
            <div class="tracker-label">Accuracy</div>
            <div class="tracker-bar">
                <div class="tracker-fill accuracy-fill" id="accuracyFill">0%</div>
            </div>
            <div class="tracker-stats">
                <span id="accuracyStats">0 correct out of 10 questions | 0% accuracy</span>
            </div>
        </div>

        <div class="instructions">
            <h3>üìö Instructions</h3>
            <p style="margin-top: 10px; font-size: 1.1em;">
                <strong>You must complete ALL the questions to progress.</strong> Try your best on the first attempt - you can only answer each question once!
            </p>
        </div>

        <div id="quizContainer">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <button class="exit-btn" id="exitBtn" disabled>Exit Quiz</button>

        <div class="results-container" id="resultsContainer">
            <h2>üéâ Quiz Complete!</h2>
            <div class="final-score" id="finalScore"></div>
            <div class="score-message" id="scoreMessage"></div>
            <div class="emoji" id="scoreEmoji"></div>
            <button class="retry-btn" onclick="location.reload()">Try Again</button>
        </div>
    </div>

    <script>
        const questions = [
            {
                id: 1,
                concept: "The S Switch - Basic Rule",
                question: "What is the 'S Switch' rule in subject-verb agreement?",
                options: [
                    "The subject and verb both take 's' at the same time",
                    "When the subject has 's', the verb doesn't; when the subject doesn't have 's', the verb does",
                    "Only plural subjects take 's'",
                    "Verbs always end in 's'"
                ],
                correct: 1,
                explanation: "The <span class='highlight'>S Switch</span> means that 's' can only appear on EITHER the subject OR the verb, but not both. For example: 'The student works' (no 's' on subject, 's' on verb) vs. 'The students work' ('s' on subject, no 's' on verb)."
            },
            {
                id: 2,
                concept: "Singular vs. Plural Subjects",
                question: "Which sentence demonstrates correct subject-verb agreement?",
                options: [
                    "The teachers teaches English.",
                    "The teacher teach English.",
                    "The teacher teaches English.",
                    "The teachers teachs English."
                ],
                correct: 2,
                explanation: "<span class='highlight'>'The teacher teaches English'</span> is correct. 'Teacher' is singular (no 's'), so the verb needs 's' (teaches). This follows the S Switch rule - the 's' switches from subject to verb when the subject is singular."
            },
            {
                id: 3,
                concept: "Trap Phrases",
                question: "Identify the correct verb: 'The box of cookies ___ on the table.'",
                options: [
                    "are",
                    "is",
                    "were",
                    "have been"
                ],
                correct: 1,
                explanation: "The correct answer is <span class='highlight'>'is'</span>. The subject is 'box' (singular), not 'cookies.' The phrase 'of cookies' is a trap phrase that comes between the subject and verb. Always identify the real subject first: What is on the table? The box (singular) is."
            },
            {
                id: 4,
                concept: "Compound Subjects with AND",
                question: "When two subjects are joined by 'and', the verb should be:",
                options: [
                    "Always singular",
                    "Always plural",
                    "Singular if both subjects are singular",
                    "It depends on the second subject only"
                ],
                correct: 1,
                explanation: "When subjects are joined by <span class='highlight'>AND</span>, they form a compound subject that is always PLURAL. Example: 'Tom and Jerry run fast' (not 'runs'). Even if both subjects are singular individually, together they make a plural subject."
            },
            {
                id: 5,
                concept: "Compound Subjects with OR/NOR",
                question: "Choose the correct verb: 'Either the teacher or the students ___ responsible.'",
                options: [
                    "is",
                    "are",
                    "was",
                    "has been"
                ],
                correct: 1,
                explanation: "The correct answer is <span class='highlight'>'are'</span>. With OR/NOR, the verb agrees with the subject CLOSEST to it. Here, 'students' (plural) is closest to the verb, so we use 'are.' If it were 'Either the students or the teacher,' we would use 'is' (singular)."
            },
            {
                id: 6,
                concept: "Indefinite Pronouns - Singular",
                question: "Which indefinite pronouns are ALWAYS singular?",
                options: [
                    "Everyone, someone, anyone, no one",
                    "All, some, most",
                    "Both, few, several, many",
                    "None of the above"
                ],
                correct: 0,
                explanation: "<span class='highlight'>Everyone, someone, anyone, no one, everybody, somebody, anybody, nobody, each, either, neither</span> are ALWAYS singular. Example: 'Everyone is here' (not 'are'). Even though 'everyone' feels plural, it's grammatically singular."
            },
            {
                id: 7,
                concept: "Indefinite Pronouns - Context Dependent",
                question: "Identify the correct verb: 'Some of the cake ___ eaten.'",
                options: [
                    "was",
                    "were",
                    "are",
                    "have"
                ],
                correct: 0,
                explanation: "The correct answer is <span class='highlight'>'was'</span>. With words like some, all, most, none, the verb depends on the object of the preposition. Here, 'cake' (singular) determines the verb. But 'Some of the cakes were eaten' uses 'were' because 'cakes' is plural."
            },
            {
                id: 8,
                concept: "Collective Nouns",
                question: "What is true about collective nouns (team, family, group, class)?",
                options: [
                    "They are always plural",
                    "They are always singular in American English",
                    "They can be singular or plural depending on context",
                    "They always take plural verbs"
                ],
                correct: 1,
                explanation: "In American English, collective nouns are <span class='highlight'>usually treated as singular</span> because they represent one unit. Example: 'The team is winning' (the team as one unit). However, when emphasizing individual members, British English sometimes uses plural verbs: 'The team are arguing among themselves.'"
            },
            {
                id: 9,
                concept: "Subjects with Prepositional Phrases",
                question: "Choose the correct verb: 'The students in the classroom ___ studying.'",
                options: [
                    "is",
                    "are",
                    "was",
                    "has"
                ],
                correct: 1,
                explanation: "The correct answer is <span class='highlight'>'are'</span>. The subject is 'students' (plural), not 'classroom.' The prepositional phrase 'in the classroom' is just extra information. Cross out prepositional phrases to find the real subject: The students [in the classroom] are studying."
            },
            {
                id: 10,
                concept: "Special Cases - Neither/Nor",
                question: "Identify the correct verb: 'Neither the books nor the pen ___ on the desk.'",
                options: [
                    "is",
                    "are",
                    "were",
                    "have"
                ],
                correct: 0,
                explanation: "The correct answer is <span class='highlight'>'is'</span>. With neither/nor, the verb agrees with the subject CLOSEST to the verb. Here, 'pen' (singular) is closest, so we use 'is.' If it were 'Neither the pen nor the books,' we would use 'are' because 'books' would be closest."
            }
        ];

        let currentQuestion = 0;
        let correctAnswers = 0;
        let answeredQuestions = 0;
        const totalQuestions = 10;
        let answeredSet = new Set();
        let correctSet = new Set();

        function renderQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.id = `question-${q.id}`;

                questionDiv.innerHTML = `
                    <div class="question-number">Question ${index + 1}: ${q.concept}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options" id="options-${q.id}">
                        ${q.options.map((option, i) => `
                            <button class="option-btn" onclick="checkAnswer(${q.id}, ${i})">${option}</button>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback-${q.id}"></div>
                `;

                container.appendChild(questionDiv);
            });
        }

        function checkAnswer(questionId, selectedIndex) {
            const question = questions.find(q => q.id === questionId);
            const optionsDiv = document.getElementById(`options-${questionId}`);
            const buttons = optionsDiv.querySelectorAll('.option-btn');
            const feedback = document.getElementById(`feedback-${questionId}`);
            const selectedButton = buttons[selectedIndex];

            if (selectedButton.classList.contains('disabled')) {
                return;
            }

            buttons.forEach(btn => {
                btn.classList.add('disabled');
                btn.style.cursor = 'not-allowed';
            });

            answeredQuestions++;

            if (!answeredSet.has(questionId)) {
                answeredSet.add(questionId);
            }

            if (selectedIndex === question.correct) {
                selectedButton.classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = `<strong>‚úì Correct!</strong> ${question.explanation}`;
                correctAnswers++;
                correctSet.add(questionId);
            } else {
                selectedButton.classList.add('incorrect');
                buttons[question.correct].classList.add('correct');
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `<strong>‚úó Not quite.</strong> ${question.explanation}`;
            }

            updateProgressTracker();

            if (answeredQuestions === questions.length) {
                setTimeout(showResults, 1000);
            }
        }

        function updateProgressTracker() {
            const progressPercentage = Math.round((answeredSet.size / totalQuestions) * 100);
            const accuracyPercentage = Math.round((correctSet.size / totalQuestions) * 100);

            const trackerFill = document.getElementById('trackerFill');
            const trackerStats = document.getElementById('trackerStats');

            trackerFill.style.width = progressPercentage + '%';
            trackerFill.textContent = progressPercentage + '%';

            trackerFill.classList.remove('low', 'medium', 'good', 'excellent');
            if (progressPercentage >= 90) {
                trackerFill.classList.add('excellent');
            } else if (progressPercentage >= 70) {
                trackerFill.classList.add('good');
            } else if (progressPercentage >= 50) {
                trackerFill.classList.add('medium');
            } else if (progressPercentage > 0) {
                trackerFill.classList.add('low');
            }

            trackerStats.textContent = `${correctSet.size} correct out of ${answeredSet.size} attempted | ${progressPercentage}% complete`;

            const accuracyFill = document.getElementById('accuracyFill');
            const accuracyStats = document.getElementById('accuracyStats');

            accuracyFill.style.width = accuracyPercentage + '%';
            accuracyFill.textContent = accuracyPercentage + '%';

            accuracyFill.classList.remove('low', 'medium', 'good', 'excellent');
            if (accuracyPercentage >= 90) {
                accuracyFill.classList.add('excellent');
            } else if (accuracyPercentage >= 70) {
                accuracyFill.classList.add('good');
            } else if (accuracyPercentage >= 50) {
                accuracyFill.classList.add('medium');
            } else if (accuracyPercentage > 0) {
                accuracyFill.classList.add('low');
            }

            accuracyStats.textContent = `${correctSet.size} correct out of ${totalQuestions} questions | ${accuracyPercentage}% accuracy`;

            ScormAPI.saveLessonProgress('subject_verb_agreement_quiz', {
                percentage: progressPercentage,
                accuracy: accuracyPercentage,
                correct: correctSet.size,
                attempted: answeredSet.size,
                total: totalQuestions,
                timestamp: new Date().toISOString()
            });
            ScormAPI.updateCourseProgress();
        }

        function showResults() {
            const resultsContainer = document.getElementById('resultsContainer');
            const finalScore = document.getElementById('finalScore');
            const scoreMessage = document.getElementById('scoreMessage');
            const scoreEmoji = document.getElementById('scoreEmoji');
            const exitBtn = document.getElementById('exitBtn');

            resultsContainer.classList.add('show');
            resultsContainer.scrollIntoView({ behavior: 'smooth' });

            const percentage = (correctAnswers / questions.length) * 100;
            finalScore.textContent = `${correctAnswers}/10 (${Math.round(percentage)}%)`;

            if (percentage === 100) {
                scoreMessage.textContent = "Perfect Score! You've mastered subject-verb agreement!";
                scoreEmoji.textContent = "üèÜüéâ";
            } else if (percentage >= 90) {
                scoreMessage.textContent = "Excellent work! You have a strong understanding of subject-verb agreement!";
                scoreEmoji.textContent = "‚≠êüòä";
            } else if (percentage >= 80) {
                scoreMessage.textContent = "Great job! You understand most concepts well!";
                scoreEmoji.textContent = "üëçüòä";
            } else if (percentage >= 70) {
                scoreMessage.textContent = "Good effort! Review the explanations to strengthen your understanding.";
                scoreEmoji.textContent = "üìöüí™";
            } else if (percentage >= 60) {
                scoreMessage.textContent = "You're making progress! Review the concepts and try again.";
                scoreEmoji.textContent = "üìñ";
            } else {
                scoreMessage.textContent = "Keep practicing! Review the lesson materials and try the quiz again.";
                scoreEmoji.textContent = "üí™üìù";
            }

            exitBtn.disabled = false;
            exitBtn.classList.add('active');
            exitBtn.style.cursor = 'pointer';
        }

        function saveAndExit(event) {
            event.preventDefault();
            ScormAPI.commit();
            window.location.href = '../index.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            ScormAPI.initialize();
            renderQuiz();
        });
    </script>
</body>
</html>
